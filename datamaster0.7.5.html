<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urbanism+ Feed & Hashtag Analysis</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define CSS variables for colors */
        :root {
            --bg-color: #dae2e8;
            --card-bg: #f0f0f3;
            --text-color: #333;
            --heading-color: #2c3e50;
            --link-card-bg: #ffffff;
            --link-card-border: #e2e8f0;
            --link-card-headline: #2c3e50;
            --link-card-description: #777;
            --link-card-url: #666;
            --subheader-color: #34495e;
            --timeframe-label-bg: #e2e8f0;
            --timeframe-label-color: #4a5568;
            --post-card-bg: #f9f9f9;
            --post-author-color: #3498db;
            --post-content-color: #444;
            --post-timestamp-color: #777;
            --no-content-color: #a0aec0; /* For "No hashtags yet" messages */
            --border-gray-200: #e5e7eb; /* For borders, like postsContainer */
            --modal-bg: #ffffff; /* Modal background */
            --modal-text: #333; /* Modal text color */
        }

        /* Dark mode styles */
        body.dark-mode {
            --bg-color: #1a202c; /* Dark background */
            --card-bg: #2d3748; /* Darker card background */
            --text-color: #e2e8f0; /* Light text */
            --heading-color: #e2e8f0;
            --link-card-bg: #4a5568; /* Dark link card bg */
            --link-card-border: #2d3748;
            --link-card-headline: #e2e8f0;
            --link-card-description: #a0aec0;
            --link-card-url: #a0aec0;
            --subheader-color: #e2e8f0;
            --timeframe-label-bg: #4a5568;
            --timeframe-label-color: #e2e8f0;
            --post-card-bg: #374151; /* Darker post card */
            --post-author-color: #63b3ed; /* Lighter blue for dark mode */
            --post-content-color: #e2e8f0;
            --post-timestamp-color: #a0aec0;
            --no-content-color: #a0aec0;
            --border-gray-200: #4a5568;
            --modal-bg: #2d3748; /* Darker modal background */
            --modal-text: #e2e8f0; /* Lighter modal text */
        }

        /* Apply variables throughout the existing CSS */
        html, body {
            height: 100%;
            min-height: 100vh; /* Ensure minimum viewport height */
            margin: 0;
            padding: 0;
            display: flex; /* Make html a flex container */
            flex-direction: column; /* Stack children vertically */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color); /* Use variable */
            color: var(--text-color); /* Use variable */
            padding: 20px; /* Padding around the main content area */
            display: flex;
            flex-direction: column; /* Arrange children vertically */
            box-sizing: border-box; /* Include padding in height calculation */
            flex-grow: 1; /* Allow body to grow and fill html height */
            align-items: center; /* Center the main-wrapper horizontally */
            /* Background properties are set by JS now */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }
        .main-wrapper {
            display: flex;
            flex-direction: column; /* Stack sections on small screens */
            gap: 30px; /* Default gap for smaller screens */
            width: 100%; /* Always take 100% of the parent's content width */
            flex-grow: 1; /* Allow main-wrapper to grow and fill body height */
        }
        @media (min-width: 1024px) { /* Side-by-side on larger screens */
            .main-wrapper {
                flex-direction: row;
                max-width: 1650px; /* Increased available space by 10% (1500 * 1.10 = 1650) */
                height: 100%; /* Ensure main-wrapper fills the height of the body */
                gap: 15px; /* Halved the gap for larger screens */
            }
            .section-wrapper {
                display: flex;
                flex-direction: column;
                min-width: 0; /* CRITICAL: Allows flex items to shrink below their content size */
                height: 100%; /* Ensure each section-wrapper fills the height of main-wrapper */
            }
            /* Specific flex properties for the three columns (4% / 38% / 58% of original content area) */
            /* Calculated based on 1620px total content width (1650px max-width - 30px total gap):
               Nav: 1620 * 0.04 = 64.8px
               Urbanism+: 1620 * 0.38 = 615.6px
               Rankings: 1620 * 0.58 = 940.6px
            */
            .section-wrapper:nth-child(1) { /* Navigation Box */
                flex: 0 0 64.8px; /* Fixed width for content */
            }
            .section-wrapper:nth-child(2) { /* Urbanism+ Box */
                flex: 0 0 615.6px; /* Fixed width for content */
            }
            .section-wrapper:nth-child(3) { /* Rankings Box - takes all remaining space */
                flex: 1; /* This will automatically expand to 940.6px content width */
            }
            /* Ensure section-cards inside are also full height */
            .section-wrapper .section-card {
                height: 100%;
            }
            /* Override padding for the navigation box's card and hide horizontal overflow */
            .section-wrapper:nth-child(1) .section-card {
                padding: 10px 5px; /* Reduced horizontal padding */
                overflow-x: hidden; /* Ensure no horizontal scroll */
                justify-content: space-between; /* Distribute items top and bottom */
                align-items: center; /* Center items horizontally */
                overflow-y: hidden; /* Prevent vertical scroll if content is only a few buttons */
            }
        }

        .section-card {
            background-color: var(--card-bg); /* Use variable */
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            padding: 25px;
            display: flex;
            flex-direction: column; /* Crucial for internal flex layout */
            flex-grow: 1; /* Allow cards to grow and fill space */
            /* Default overflow-y: auto removed from here */
            position: relative; /* Needed for absolute positioning of connection status */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }

        /* Specific rule for Urbanism+ section-card to prevent its own scrolling */
        .section-wrapper:nth-child(2) .section-card { /* Urbanism+ Box */
            overflow-y: hidden; /* Ensure only iframe scrolls */
        }

        /* Specific rule for Rankings section-card (which needs scroll) */
        .section-wrapper:nth-child(3) .section-card {
            overflow-y: auto; /* This card needs to scroll for its content */
        }


        /* Stylish Title for main sections */
        .stylish-section-title {
            font-size: 2rem; /* Larger title */
            font-weight: 800; /* Extra bold */
            color: var(--heading-color); /* Use variable */
            margin-bottom: 20px;
            text-align: center;
            display: flex; /* Use flexbox for image and text alignment */
            align-items: center; /* Vertically align items */
            justify-content: flex-start; /* Changed: Left-align content within the title */
            gap: 10px; /* Space between image and text */
            padding-bottom: 10px; /* Space for a subtle border/shadow */
            border-bottom: 3px solid #3498db; /* Accent border */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Subtle shadow below the title */
            border-radius: 4px; /* Slightly rounded bottom border */
            flex-shrink: 0; /* Prevent title from shrinking */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .stylish-section-title img {
            height: 40px; /* Adjust image size */
            width: auto;
            border-radius: 8px; /* Slightly rounded image */
        }

        .post-card {
            background-color: var(--post-card-bg); /* Use variable */
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--post-author-color); /* Accent color */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }
        .post-author {
            font-weight: bold;
            color: var(--post-author-color); /* Use variable */
            margin-bottom: 5px;
            font-size: 1.1rem;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .post-content {
            color: var(--post-content-color); /* Use variable */
            line-height: 1.5;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .post-timestamp {
            font-size: 0.85rem;
            color: var(--post-timestamp-color); /* Use variable */
            margin-top: 10px;
            text-align: right;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        /* Adjusted analysis-item for general use, but link-cards will override */
        .analysis-item {
            display: flex;
            align-items: flex-start; /* Align items to the top if label wraps */
            padding: 4px 0; /* Changed: Smaller vertical padding for hashtags */
            border-bottom: 1px dashed #eee; /* This border will need adjustment for dark mode if kept */
            gap: 10px; /* Add a small gap between label and value */
        }
        .analysis-item:last-child {
            border-bottom: none;
        }
        .analysis-label {
            font-weight: 500;
            color: var(--text-color); /* Use variable */
            flex-grow: 1; /* Allow it to grow */
            word-break: break-word; /* Ensure long words break */
            min-width: 0; /* Important for flex items to shrink properly */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .analysis-value {
            font-weight: bold;
            color: var(--heading-color); /* Use variable */
            flex-shrink: 0; /* Prevent it from shrinking */
            white-space: nowrap; /* Keep the count on one line */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .loading-indicator {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            color: var(--no-content-color); /* Use variable */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .feed-name-display { /* This class is no longer used for display, but kept for consistency */
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color); /* Use variable */
            text-align: center;
            margin-bottom: 15px;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .iframe-embed {
            width: 100%;
            /* Removed height: 100%; to fix double scrollbar - relies on flex-grow: 1 */
            min-height: 500px; /* Ensure a minimum height for the iframe */
            border: none;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            flex-grow: 1; /* Allow iframe to grow within its container */
            display: block; /* Ensures it respects flex properties better */
            /* The iframe itself will handle its own scrolling if its content overflows */
        }
        .timeframe-selector {
            display: flex;
            justify-content: flex-start; /* Changed: Left-align buttons within the selector */
            gap: 10px;
            margin-bottom: 15px; /* Changed: Reduced margin-bottom */
            margin-top: 10px; /* Added: Small margin-top to separate from title/status */
            flex-wrap: wrap; /* Allow wrapping on small screens */
            flex-shrink: 0; /* Prevent selector from shrinking */
        }
        .timeframe-selector label {
            background-color: var(--timeframe-label-bg); /* Use variable */
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: var(--timeframe-label-color); /* Use variable */
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap; /* Prevent text from wrapping inside label */
        }
        .timeframe-selector input[type="radio"] {
            display: none;
        }
        .timeframe-selector input[type="radio"]:checked + label {
            background-color: #3498db; /* Keep accent blue consistent */
            color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        /* Modern Link Card Styling */
        .link-card {
            background-color: var(--link-card-bg); /* Use variable */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer shadow */
            padding: 10px; /* Changed: Smaller vertical padding */
            margin-bottom: 8px; /* Changed: Smaller margin-bottom */
            transition: all 0.3s ease; /* Smooth transitions for hover effects */
            display: block; /* Ensure it behaves like a block for full clickability */
            text-decoration: none; /* Remove underline from link */
            color: inherit; /* Inherit text color */
            border: 1px solid var(--link-card-border); /* Use variable */
        }
        .link-card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); /* More pronounced shadow on hover */
            transform: translateY(-2px); /* Slight lift effect */
            border-color: #3498db; /* Highlight border on hover */
        }
        .link-card-headline {
            font-weight: 600; /* Slightly bolder */
            font-size: 1rem; /* Slightly smaller headline for compactness */
            color: var(--link-card-headline); /* Use variable */
            margin-bottom: 4px; /* Reduced margin */
            line-height: 1.3;
            white-space: normal; /* Changed: Allow text to wrap */
            overflow: visible; /* Changed: Allow overflow to be visible (text wraps) */
            text-overflow: clip; /* Changed: No ellipsis, clip if necessary after wrap */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .link-card-description { /* New style for description */
            font-size: 0.75rem; /* Smaller font for description */
            color: var(--link-card-description); /* Use variable */
            margin-bottom: 6px; /* Space below description */
            line-height: 1.4;
            overflow: visible; /* Changed: Allow overflow to be visible (text wraps) */
            text-overflow: clip; /* Changed: No ellipsis, clip if necessary after wrap */
            display: block; /* Changed: Ensure it behaves like a block, overriding -webkit-box for full wrapping */
            -webkit-line-clamp: unset; /* Changed: Remove line clamp */
            -webkit-box-orient: unset; /* Changed: Remove box orient */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .link-card-url {
            font-size: 0.8rem; /* Smaller URL text */
            color: var(--link-card-url); /* Use variable */
            white-space: nowrap; /* Keep URL on one line */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis for overflow */
            margin-bottom: 6px; /* Reduced margin */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .link-card-count {
            font-size: 0.9rem; /* Slightly smaller count */
            font-weight: bold;
            color: #3498db; /* Accent color for count (stays consistent) */
        }
        .link-card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between; /* Space out items */
        }
        .link-card-comment-btn {
            background-color: transparent;
            border: none;
            padding: 4px 8px; /* Slightly more padding */
            border-radius: 6px; /* Slightly rounded */
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-color); /* Inherit color, or specific icon color */
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .link-card-comment-btn:hover {
            background-color: var(--timeframe-label-bg); /* Use a subtle hover background */
        }
        .link-card-comment-btn svg {
            width: 20px; /* Adjust icon size */
            height: 20px;
            color: var(--subheader-color); /* Make icon stand out a bit */
            transition: color 0.3s ease;
        }
        body.dark-mode .link-card-comment-btn svg {
            color: var(--subheader-color); /* Keep distinct in dark mode */
        }

        /* Modern Domain Card Styling (similar to link-card) */
        .domain-card {
            background-color: var(--link-card-bg); /* Use variable */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer shadow */
            padding: 10px; /* Changed: Smaller vertical padding */
            margin-bottom: 8px; /* Changed: Smaller margin-bottom */
            transition: all 0.3s ease; /* Smooth transitions for hover effects */
            display: block;
            text-decoration: none;
            color: inherit;
            border: 1px solid var(--link-card-border); /* Use variable */
        }
        .domain-card:hover {
            box_shadow: 0 6px 16px rgba(0, 0, 0, 0.15); /* More pronounced shadow on hover */
            transform: translateY(-2px); /* Slight lift effect */
            border-color: #3498db; /* Highlight border on hover */
        }
        .domain-card-name {
            font-weight: 600;
            font-size: 1rem; /* Slightly smaller name for compactness */
            color: var(--link-card-headline); /* Use variable */
            margin-bottom: 4px; /* Reduced margin */
            line-height: 1.3;
            white-space: nowrap; /* Keep on one line */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis for overflow */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .domain-card-count {
            font-size: 0.9rem; /* Slightly smaller count */
            font-weight: bold;
            color: #3498db; /* Accent color for count (stays consistent) */
        }
        /* Style for connected status text */
        .text-green-600 {
            font-weight: 600;
        }

        /* Stylish sub-headers for analysis sections */
        .stylish-subheader {
            font-size: 1.5rem; /* Slightly larger than before */
            font-weight: 700; /* Bolder */
            color: var(--subheader-color); /* Use variable */
            margin-bottom: 15px;
            text-align: left; /* Changed: Left-align subheaders */
            position: relative; /* For pseudo-elements if needed */
            padding-bottom: 8px;
            flex-shrink: 0; /* Prevent subheader from shrinking */
            transition: 
