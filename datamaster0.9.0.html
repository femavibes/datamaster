<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urbanism+ Feed & Hashtag Analysis</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define CSS variables for colors */
        :root {
            --bg-color: #dae2e8;
            --card-bg: #f0f0f3;
            --text-color: #333;
            --heading-color: #2c3e50;
            --link-card-bg: #ffffff;
            --link-card-border: #e2e8f0;
            --link-card-headline: #2c3e50;
            --link-card-description: #777;
            --link-card-url: #666;
            --subheader-color: #34495e;
            --timeframe-label-bg: #e2e8f0;
            --timeframe-label-color: #4a5568;
            --post-card-bg: #f9f9f9;
            --post-author-color: #3498db;
            --post-content-color: #444;
            --post-timestamp-color: #777;
            --no-content-color: #a0aec0; /* For "No hashtags yet" messages */
            --border-gray-200: #e5e7eb; /* For borders, like postsContainer */
            --modal-bg: #ffffff; /* Modal background */
            --modal-text: #333; /* Modal text color */
        }

        /* Dark mode styles */
        body.dark-mode {
            --bg-color: #1a202c; /* Dark background */
            --card-bg: #2d3748; /* Darker card background */
            --text-color: #e2e8f0; /* Light text */
            --heading-color: #e2e8f0;
            --link-card-bg: #4a5568; /* Dark link card bg */
            --link-card-border: #2d3748;
            --link-card-headline: #e2e8f0;
            --link-card-description: #a0aec0;
            --link-card-url: #a0aec0;
            --subheader-color: #e2e8f0;
            --timeframe-label-bg: #4a5568;
            --timeframe-label-color: #e2e8f0;
            --post-card-bg: #374151; /* Darker post card */
            --post-author-color: #63b3ed; /* Lighter blue for dark mode */
            --post-content-color: #e2e8f0;
            --post-timestamp-color: #a0aec0;
            --no-content-color: #a0aec0;
            --border-gray-200: #4a5568;
            --modal-bg: #2d3748; /* Darker modal background */
            --modal-text: #e2e8f0; /* Lighter modal text */
        }

        /* Apply variables throughout the existing CSS */
        html, body {
            height: 100%;
            min-height: 100vh; /* Ensure minimum viewport height */
            margin: 0;
            padding: 0;
            display: flex; /* Make html a flex container */
            flex-direction: column; /* Stack children vertically */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color); /* Use variable */
            color: var(--text-color); /* Use variable */
            padding: 20px; /* Padding around the main content area */
            display: flex;
            flex-direction: column; /* Arrange children vertically */
            box-sizing: border-box; /* Include padding in height calculation */
            flex-grow: 1; /* Allow body to grow and fill html height */
            align-items: center; /* Center the main-wrapper horizontally */
            /* Background properties are set by JS now */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }
        .main-wrapper {
            display: flex;
            flex-direction: column; /* Stack sections on small screens */
            gap: 30px; /* Default gap for smaller screens */
            width: 100%; /* Always take 100% of the parent's content width */
            flex-grow: 1; /* Allow main-wrapper to grow and fill body height */
        }
        @media (min-width: 1024px) { /* Side-by-side on larger screens */
            .main-wrapper {
                flex-direction: row;
                max-width: 1840px; /* Increased available space for Rankings box */
                height: 100%; /* Ensure main-wrapper fills the height of the body */
                gap: 15px; /* Halved the gap for larger screens */
            }
            .section-wrapper {
                display: flex;
                flex-direction: column;
                min-width: 0; /* CRITICAL: Allows flex items to shrink below their content size */
                height: 100%; /* Ensure each section-wrapper fills the height of main-wrapper */
            }
            /* Specific flex properties for the three columns (Updated percentages/widths) */
            /* Calculated based on 1810px total content width (1840px max-width - 30px total gap):
               Nav: 64.8px -> flex: 0 0 64.8px;
               Urbanism+: 615.6px -> flex: 0 0 615.6px;
               Rankings: 1129.6px (1810 - 64.8 - 615.6) -> flex: 1;
            */
            .section-wrapper:nth-child(1) { /* Navigation Box */
                flex: 0 0 64.8px; /* Fixed width for content */
            }
            .section-wrapper:nth-child(2) { /* Urbanism+ Box */
                flex: 0 0 615.6px; /* Fixed width for content */
            }
            .section-wrapper:nth-child(3) { /* Rankings Box - takes all remaining space */
                flex: 1; /* This will automatically expand to 1129.6px content width */
            }
            /* Ensure section-cards inside are also full height */
            .section-wrapper .section-card {
                height: 100%;
            }
            /* Override padding for the navigation box's card and hide horizontal overflow */
            .section-wrapper:nth-child(1) .section-card {
                padding: 10px 5px; /* Reduced horizontal padding */
                overflow-x: hidden; /* Ensure no horizontal scroll */
                justify-content: space-between; /* Distribute items top and bottom */
                align-items: center; /* Center items horizontally */
                overflow-y: hidden; /* Prevent vertical scroll if content is only a few buttons */
            }
        }

        .section-card {
            background-color: var(--card-bg); /* Use variable */
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            padding: 25px;
            display: flex;
            flex-direction: column; /* Crucial for internal flex layout */
            flex-grow: 1; /* Allow cards to grow and fill space */
            position: relative; /* Needed for absolute positioning of connection status */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }

        /* Specific rule for Urbanism+ section-card to prevent its own scrolling */
        .section-wrapper:nth-child(2) .section-card { /* Urbanism+ Box */
            overflow-y: hidden; /* Ensure only iframe scrolls */
        }

        /* Specific rule for Rankings section-card (which needs scroll) */
        .section-wrapper:nth-child(3) .section-card {
            overflow-y: auto; /* Re-add this to ensure the main card gets a scrollbar if contents overflow */
        }

        /* Ensure the grid of ranking sections within the Rankings card can shrink */
        /* Also ensure the flex-col divs within the grid can shrink, critical for inner scrollbars */
        .section-wrapper:nth-child(3) .section-card .grid,
        .section-wrapper:nth-child(3) .section-card .grid > .md\:col-span-3.flex.flex-col,
        .section-wrapper:nth-child(3) .section-card .grid > .md\:col-span-5.flex.flex-col,
        .section-wrapper:nth-child(3) .section-card .grid > .md\:col-span-4.flex.flex-col {
            min-height: 0; /* CRITICAL: Allows flex items to shrink below their content size */
        }


        /* Stylish Title for main sections */
        .stylish-section-title {
            font-size: 2rem; /* Larger title */
            font-weight: 800; /* Extra bold */
            color: var(--heading-color); /* Use variable */
            /* margin-bottom is handled by the new flex container now */
            text-align: center;
            display: flex; /* Use flexbox for image and text alignment */
            align-items: center; /* Vertically align items */
            justify-content: flex-start; /* Changed: Left-align content within the title */
            gap: 10px; /* Space between image and text */
            padding-bottom: 10px; /* Space for a subtle border/shadow */
            border-bottom: 3px solid #3498db; /* Accent border */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Subtle shadow below the title */
            border-radius: 4px; /* Slightly rounded bottom border */
            flex-shrink: 0; /* Prevent title from shrinking */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        /* Style for the link element wrapping the icon and text in the title */
        .stylish-section-title a.feed-title-link {
            text-decoration: none; /* Remove underline from link */
            color: inherit; /* Inherit text color */
            display: flex; /* Ensure flex for icon/text alignment */
            align-items: center; /* Vertically align items */
            gap: 10px; /* Space between icon and text */
        }
        /* Style for the circular container of the icon in the title */
        .feed-title-icon-wrapper {
            width: 48px; /* Match navigation button width */
            height: 48px; /* Match navigation button height */
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0; /* Prevent shrinking */
            /* Reverted border to 2px for header icons */
            border: 2px solid rgba(0, 0, 0, 0.1); 
        }
        body.dark-mode .feed-title-icon-wrapper {
            /* Reverted border to 2px for dark mode header icons */
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* Style for the image inside the feed title icon wrapper */
        .feed-title-icon-wrapper img {
            width: 100%; /* Fill parent */
            height: 100%;
            object-fit: cover;
            border-radius: 50%; /* Ensure image itself is round */
            transition: none !important; /* IMPORTANT: Prevent any hover transition on transform */
            transform: scale(var(--title-icon-scale, 1)); /* Set by JS with default */
        }
        /* Style for the SVG inside the feed title icon wrapper */
        .feed-title-icon-wrapper svg {
            width: 100%; /* Fill parent */
            height: 100%;
            transition: none !important; /* Prevent any hover transition on transform */
        }


        .post-card {
            background-color: var(--post-card-bg); /* Use variable */
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            border-left: 5px solid var(--post-author-color); /* Accent color */
            transition: background-color 0.3s ease; /* Smooth transition for dark mode */
        }
        .post-author {
            font-weight: bold;
            color: var(--post-author-color); /* Use variable */
            margin-bottom: 5px;
            font-size: 1.1rem;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .post-content {
            color: var(--post-content-color); /* Use variable */
            line-height: 1.5;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .post-timestamp {
            font-size: 0.85rem;
            color: var(--post-timestamp-color); /* Use variable */
            margin-top: 10px;
            text-align: right;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        /* Adjusted analysis-item for general use, but link-cards will override */
        .analysis-item {
            display: flex;
            align-items: flex-start; /* Align items to the top if label wraps */
            padding: 4px 0; /* Changed: Smaller vertical padding for hashtags */
            border-bottom: 1px dashed #eee; /* This border will need adjustment for dark mode if kept */
            gap: 10px; /* Add a small gap between label and value */
        }
        .analysis-item:last-child {
            border-bottom: none;
        }
        .analysis-label {
            font-weight: 500;
            color: var(--text-color); /* Use variable */
            flex-grow: 1; /* Allow it to grow */
            word-break: break-word; /* Ensure long words break */
            min-width: 0; /* Important for flex items to shrink properly */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .analysis-value {
            font-weight: bold;
            color: var(--heading-color); /* Use variable */
            flex-shrink: 0; /* Prevent it from shrinking */
            white-space: nowrap; /* Keep the count on one line */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .loading-indicator {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
            color: var(--no-content-color); /* Use variable */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .feed-name-display { /* This class is no longer used for display, but kept for consistency */
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color); /* Use variable */
            text-align: center;
            margin-bottom: 15px;
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .iframe-embed {
            width: 100%;
            /* Removed height: 100%; to fix double scrollbar - relies on flex-grow: 1 */
            min-height: 500px; /* Ensure a minimum height for the iframe */
            border: none;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            flex-grow: 1; /* Allow iframe to grow within its container */
            display: block; /* Ensures it respects flex properties better */
            /* The iframe itself will handle its own scrolling if its content overflows */
        }
        /* Adjusted timeframe selector for inline display with header */
        .timeframe-selector {
            display: flex;
            justify-content: flex-start; /* Changed: Left-align buttons within the selector */
            gap: 10px;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            flex-shrink: 0; /* Prevent selector from shrinking */
        }
        .timeframe-selector label {
            background-color: var(--timeframe-label-bg); /* Use variable */
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: var(--timeframe-label-color); /* Use variable */
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap; /* Prevent text from wrapping inside label */
        }
        .timeframe-selector input[type="radio"] {
            display: none;
        }
        .timeframe-selector input[type="radio"]:checked + label {
            background-color: #3498db; /* Keep accent blue consistent */
            color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        /* Modern Link Card Styling */
        .link-card {
            background-color: var(--link-card-bg); /* Use variable */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer shadow */
            padding: 10px; /* Changed: Smaller vertical padding */
            margin-bottom: 8px; /* Changed: Smaller margin-bottom */
            transition: all 0.3s ease; /* Smooth transitions for hover effects */
            display: block; /* Ensure it behaves like a block for full clickability */
            text-decoration: none; /* Remove underline from link */
            color: inherit; /* Inherit text color */
            border: 1px solid var(--link-card-border); /* Use variable */
        }
        .link-card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15); /* More pronounced shadow on hover */
            transform: translateY(-2px); /* Slight lift effect */
            border-color: #3498db; /* Highlight border on hover */
        }
        .link-card-headline {
            font-weight: 600; /* Slightly bolder */
            font-size: 1rem; /* Slightly smaller headline for compactness */
            color: var(--link-card-headline); /* Use variable */
            margin-bottom: 4px; /* Reduced margin */
            line-height: 1.3;
            white-space: normal; /* Changed: Allow text to wrap */
            overflow: visible; /* Changed: Allow overflow to be visible (text wraps) */
            text-overflow: clip; /* Changed: No ellipsis, clip if necessary after wrap */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .link-card-description { /* New style for description */
            font-size: 0.75rem; /* Smaller font for description */
            color: var(--link-card-description); /* Use variable */
            margin-bottom: 6px; /* Space below description */
            line-height: 1.4;
            overflow: visible; /* Changed: Allow overflow to be visible (text wraps) */
            text-overflow: clip; /* Changed: No ellipsis, clip if necessary after wrap */
            display: block; /* Changed: Ensure it behaves like a block, overriding -webkit-box for full wrapping */
            -webkit-line-clamp: unset; /* Changed: Remove line clamp */
            -webkit-box-orient: unset; /* Changed: Remove box orient */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .link-card-url {
            font-size: 0.8rem; /* Smaller URL text */
            color: var(--link-card-url); /* Use variable */
            white-space: nowrap; /* Keep URL on one line */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis for overflow */
            margin-bottom: 6px; /* Reduced margin */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .link-card-count-wrapper { /* New wrapper for count to make it a distinct clickable area */
            font-size: 0.9rem; /* Slightly smaller count */
            font-weight: bold;
            color: #3498db; /* Accent color for count (stays consistent) */
            cursor: pointer; /* Indicate clickability */
            display: inline-block; /* Allow padding and hover effect */
            padding: 2px 4px; /* Small padding around count text */
            border-radius: 4px;
        }
        .link-card-count-wrapper:hover {
            text-decoration: underline; /* Underline on hover */
            background-color: rgba(52, 152, 219, 0.1); /* Subtle blue background on hover */
        }
        .link-card-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Align count to the right */
        }
        /* Removed .link-card-comment-btn as it's no longer needed */
        /* .link-card-comment-btn {
            background-color: transparent;
            border: none;
            padding: 4px 8px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            color: var(--text-color);
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .link-card-comment-btn:hover {
            background-color: var(--timeframe-label-bg);
        }
        .link-card-comment-btn svg {
            width: 20px;
            height: 20px;
            color: var(--subheader-color);
            transition: color 0.3s ease;
        }
        body.dark-mode .link-card-comment-btn svg {
            color: var(--subheader-color);
        } */
        /* New CSS for image inside link card */
        .link-card img {
            width: 100%;
            height: 128px; /* Fixed height for thumbnails */
            object-fit: cover; /* Cover the area, cropping if necessary */
            border-radius: 8px 8px 0 0; /* Rounded top corners, sharp bottom */
            margin-bottom: 8px; /* Space below image */
        }

        /* Modern Domain Card Styling (similar to link-card) */
        .domain-card {
            background-color: var(--link-card-bg); /* Use variable */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Softer shadow */
            padding: 10px; /* Changed: Smaller vertical padding */
            margin-bottom: 8px; /* Changed: Smaller margin-bottom */
            transition: all 0.3s ease; /* Smooth transitions for hover effects */
            display: block;
            text-decoration: none;
            color: inherit;
            border: 1px solid var(--link-card-border); /* Use variable */
        }
        .domain-card:hover {
            box_shadow: 0 6px 16px rgba(0, 0, 0, 0.15); /* More pronounced shadow on hover */
            transform: translateY(-2px);
            border-color: #3498db; /* Highlight border on hover */
        }
        .domain-card-name {
            font-weight: 600;
            font-size: 1rem; /* Slightly smaller name for compactness */
            color: var(--link-card-headline); /* Use variable */
            margin-bottom: 4px; /* Reduced margin */
            line-height: 1.3;
            white-space: nowrap; /* Keep on one line */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis for overflow */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .domain-card-count {
            font-size: 0.9rem; /* Slightly smaller count */
            font-weight: bold;
            color: #3498db; /* Accent color for count (stays consistent) */
        }
        /* Style for connected status text */
        .text-green-600 {
            font-weight: 600;
        }

        /* Stylish sub-headers for analysis sections */
        .stylish-subheader {
            font-size: 1.5rem; /* Slightly larger than before */
            font-weight: 700; /* Bolder */
            color: var(--subheader-color); /* Use variable */
            margin-bottom: 15px;
            text-align: left; /* Changed: Left-align subheaders */
            position: relative; /* For pseudo-elements if needed */
            padding-bottom: 8px;
            flex-shrink: 0; /* Prevent subheader from shrinking */
            transition: color 0.3s ease; /* Smooth transition for dark mode */
        }
        .stylish-subheader::after {
            content: '';
            position: absolute;
            left: 0; /* Changed: Align underline to the left */
            bottom: 0;
            width: 50px; /* Short underline */
            height: 3px;
            background-color: #3498db; /* Accent color */
            border-radius: 2px;
        }

        /* Added for the rankings section to align its content to the left */
        .section-wrapper:last-child .section-card {
            align-items: flex-start;
        }
        /* Specific styling for the handle and DID in Top Posters */
        .poster-card { /* Reusing link-card styles but adjusting */
            display: flex;
            align-items: center; /* Align avatar and text */
            gap: 10px; /* Space between avatar and text */
            background-color: var(--link-card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 10px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            text-decoration: none; /* The outer poster-card link for profile */
            color: inherit;
            border: 1px solid var(--link-card-border);
        }
        .poster-card:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
            border-color: #3498db;
        }
        .poster-avatar {
            width: 40px; /* Size for poster avatar */
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }
        .poster-info {
            flex-grow: 1;
            min-width: 0; /* Allow text to shrink */
        }
        .poster-display-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--link-card-headline);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .poster-handle {
            font-size: 0.85rem;
            color: var(--link-card-url);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .poster-count-wrapper { /* New wrapper for count to make it a distinct clickable area */
            font-size: 0.9rem;
            font-weight: bold;
            color: #3498db;
            cursor: pointer;
            display: inline-block;
            padding: 2px 4px;
            border-radius: 4px;
            flex-shrink: 0;
        }
        .poster-count-wrapper:hover {
            text-decoration: underline;
            background-color: rgba(52, 152, 219, 0.1);
        }


        /* Styling for the modal */
        #settingsModal .bg-white { /* Target the modal content box */
            background-color: var(--modal-bg);
            color: var(--modal-text);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #settingsModal h3,
        #settingsModal label,
        #settingsModal select {
            color: var(--modal-text); /* Ensure modal text is readable in dark mode */
        }
        #settingsModal select {
            background-color: var(--card-bg); /* Use card-bg for select background */
            border-color: var(--link-card-border); /* Use link-card-border for select border */
            color: var(--text-color); /* Use text-color for select text */
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        #settingsModal select option {
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        /* Styles for feed selection buttons */
        .feed-select-btn {
            padding: 12px; /* Increased padding */
            border-radius: 50%; /* Make it round */
            display: flex;
            justify-content: center;
            align-items: center;
            width: 48px; /* Fixed width */
            height: 48px;
            margin-bottom: 15px; /* Space between buttons */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease-in-out;
            /* Reverted border to 2px for navigation buttons */
            border: 2px solid transparent; 
            overflow: hidden; /* IMPORTANT: Ensures zoomed images are clipped to the circle */
        }
        .feed-select-btn:last-of-type {
            margin-bottom: 0; /* No margin after the last button */
        }
        .feed-select-btn:hover {
            transform: scale(1.08); /* Slightly larger on hover */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .feed-select-btn.active-feed-btn {
            background-color: #3498db; /* Blue for active state */
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            /* Reverted border to 2px for active navigation buttons */
            border: 2px solid #287bbd; 
        }
        .feed-select-btn.active-feed-btn svg {
            color: white; /* Ensure SVG icon is white when active */
        }
        .feed-select-btn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%; /* Make image round */
            /* Default transform, will be overridden by specific rules below */
            transform: scale(1);
            transition: transform 0.2s ease-in-out; /* Smooth transition for zoom effect */
        }
        /* Specific rule for zooming in the images */
        #urbanismPlusFeedBtn img {
            transform: scale(2.42); /* Original value */
        }
        #bandcampFeedBtn img {
            transform: scale(2.80); /* Original value */
        }

        .feed-select-btn svg {
            width: 28px; /* Slightly larger SVG icons */
            height: 28px;
            color: #333; /* Default SVG color (matches text-color var) */
            transition: color 0.3s ease;
        }
        body.dark-mode .feed-select-btn svg {
            color: #e2e8f0; /* Light color for dark mode */
        }
        /* Specific margin for the plus button to ensure it's at the very top */
        #plusBtn {
            margin-bottom: 15px; /* Adjust spacing below plus button */
        }
        /* Ensure feed selection buttons don't push the settings button up */
        .nav-buttons-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex-grow: 1; /* Allows this container to push content to bottom */
            padding-top: 10px; /* Small padding from the top of the card */
            padding-bottom: 10px; /* Small padding from the bottom of the card */
        }

        /* Line spacer styles */
        .line-spacer {
            width: 80%; /* Shorter line */
            height: 2px;
            background-color: #ddd; /* Light grey line */
            margin: 10px 0 20px 0; /* Top/bottom margin, 20px on bottom for better separation */
            border-radius: 1px; /* Rounded ends */
            opacity: 0.7; /* Slightly transparent */
        }
        body.dark-mode .line-spacer {
            background-color: #4a5568; /* Darker grey for dark mode */
        }

        /* New: Styling for individual ranking scroll areas */
        .ranking-scroll-area {
            overflow-y: auto;
            padding-right: 10px; /* Space for scrollbar */
            flex-grow: 1; /* Allow it to fill available vertical space */
            margin-bottom: 20px; /* Add margin-bottom here to push down if needed */
        }
        /* Hide scrollbar for aesthetic purposes if needed, but keep functionality */
        .ranking-scroll-area::-webkit-scrollbar {
            width: 8px;
        }
        .ranking-scroll-area::-webkit-scrollbar-track {
            background: var(--card-bg); /* Use card background for track */
            border-radius: 10px;
        }
        .ranking-scroll-area::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .ranking-scroll-area::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        body.dark-mode .ranking-scroll-area::-webkit-scrollbar-thumb {
            background: #a0aec0;
        }
        body.dark-mode .ranking-scroll-area::-webkit-scrollbar-track {
            background: #2d3748;
        }

        /* Styling for the new ranking toggle buttons */
        .ranking-toggle-btn {
            background-color: var(--timeframe-label-bg);
            color: var(--timeframe-label-color);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .ranking-toggle-btn:hover {
            background-color: #3498db; /* Blue for hover */
            color: #ffffff;
        }
        .ranking-toggle-btn.active {
            background-color: #3498db;
            color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* NEW: Styles for Featured Feeds section */
        .featured-feed-card {
            display: flex;
            align-items: center;
            gap: 15px;
            background-color: var(--link-card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 15px;
            margin-bottom: 10px; /* Keep consistent margin for grid items */
            text-decoration: none; /* For the <a> tag */
            color: inherit;
            transition: all 0.3s ease;
            border: 1px solid var(--link-card-border);
        }
        .featured-feed-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
            border-color: #3498db;
        }
        .featured-feed-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 2px solid rgba(0,0,0,0.1);
        }
        body.dark-mode .featured-feed-icon {
            border: 2px solid rgba(255,255,255,0.1);
        }
        .featured-feed-info {
            flex-grow: 1;
        }
        .featured-feed-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--link-card-headline);
            margin-bottom: 4px;
        }
        .featured-feed-description {
            font-size: 0.9rem;
            color: var(--link-card-description);
            line-height: 1.4;
        }

    </style>
</head>
<body>
    <div class="main-wrapper">
        <!-- Section for Slim Navigation Box - NEW -->
        <div class="section-wrapper">
            <div class="section-card flex flex-col justify-between items-center p-3 h-full">
                <!-- Fema Button at the very top - NEW -->
                <a id="femaProfileBtn" href="https://bsky.app/profile/fema.monster" target="_blank" rel="noopener noreferrer" 
                   class="p-0 bg-transparent rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                    <img src="https://raw.githubusercontent.com/femavibes/datamaster/refs/heads/main/fema.jpg" alt="Fema Monster" class="w-12 h-12 rounded-full border-2 border-transparent hover:border-blue-500 transition-all duration-300">
                </a>
                <!-- Line spacer under Fema button -->
                <div class="line-spacer"></div>

                <!-- NEW: Home Button -->
                <button id="homeFeedBtn" class="feed-select-btn bg-gray-200 mb-4">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path>
                    </svg>
                </button>
                <!-- Line spacer under Home button -->
                <div class="line-spacer"></div>


                <!-- Plus button (now below Home button) -->
                <button id="plusBtn" class="p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                </button>
                <!-- Line spacer under plus button -->
                <div class="line-spacer"></div>

                <!-- Container for feed selection buttons -->
                <div class="nav-buttons-container">
                    <button id="urbanismPlusFeedBtn" class="feed-select-btn bg-gray-200">
                        <img src="https://raw.githubusercontent.com/femavibes/datamaster/refs/heads/main/uplus.jpg" alt="Urbanism+ Logo">
                    </button>
                    <button id="bandcampFeedBtn" class="feed-select-btn bg-gray-200">
                        <img src="https://raw.githubusercontent.com/femavibes/datamaster/refs/heads/main/bandcamp7796.logowik.com.webp" alt="Bandcamp Logo">
                    </button>
                    <button id="transitSkyFeedBtn" class="feed-select-btn bg-gray-200">
                        <!-- Generic SVG for TransitSky -->
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm-1 14H7.5c-.276 0-.5-.224-.5-.5V7.5c0-.276.224-.5.5-.5H11V16zm5.5 0H13c-.276 0-.5-.224-.5-.5V7.5c0-.276.224-.5.5-.5H16.5c.276 0 .5.224.5.5V15.5c0 .276-.224.5-.5.5z"/>
                        </svg>
                    </button>
                    <!-- Add more feed buttons here as needed -->
                </div>

                <!-- Gearbox button at the bottom -->
                <button id="openSettingsBtn" class="p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.942 3.333.942 1.89 2.395a1.724 1.724 0 00.01 2.59c1.543 1.453-.294 3.333-1.89 2.395a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.942-3.333-.942-1.89-2.395a1.724 1.724 0 00-.01-2.59c-1.543-1.453.294-3.333 1.89-2.395a1.724 1.724 0 002.573-1.066z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Section for Iframe Embed (Urbanism+) -->
        <div class="section-wrapper">
            <div class="section-card">
                <!-- New flex container for title and version buttons -->
                <div class="flex justify-between items-center mb-4">
                    <h2 class="stylish-section-title mb-0 mr-4">
                        <a id="feedTitleLink" href="#" target="_blank" rel="noopener noreferrer" class="feed-title-link">
                            <div class="feed-title-icon-wrapper">
                                <img id="feedTitleIcon" src="https://raw.githubusercontent.com/femavibes/datamaster/refs/heads/main/uplus.jpg" alt="Feed Logo">
                            </div>
                            <span id="feedTitleText">Urbanism+</span>
                        </a>
                    </h2>
                    <div id="feedVersionButtons" class="flex gap-2">
                        <!-- Buttons will be rendered here by JS -->
                    </div>
                </div>
                <iframe
                    id="mainIframe"
                    src="https://graze.social/feeds/embed/3654"
                    title="Social Feed"
                    class="iframe-embed"
                    allowFullScreen
                ></iframe>
            </div>
        </div>

        <!-- Section for Live Analysis (Contrails data processed in background) - Now on the right -->
        <div class="section-wrapper">
            <div class="section-card">
                <!-- Main header for Rankings section -->
                <div class="flex flex-col sm:flex-row justify-between sm:items-center w-full mb-4">
                    <div class="flex flex-col sm:flex-row items-center flex-grow-0 gap-4 mb-4 sm:mb-0">
                        <h2 class="stylish-section-title mb-0" id="rankingsSectionTitle">Rankings</h2>
                        <div id="timeframeSelectorContainer" class="timeframe-selector flex-shrink-0 sm:ml-8">
                            <input type="radio" id="timeframeDay" name="timeframe" value="day">
                            <label for="timeframeDay">Day</label>
                            <input type="radio" id="timeframeWeek" name="timeframe" value="week">
                            <label for="timeframeWeek">Week</label>
                            <input type="radio" id="timeframeMonth" name="timeframe" value="month">
                            <label for="timeframeMonth">Month</label>
                            <input type="radio" id="timeframeAllTime" name="timeframe" value="allTime" checked>
                            <label for="timeframeAllTime">All Time</label>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600 flex flex-col items-end flex-shrink-0">
                        <span id="connectionStatus">Initializing...</span>
                        <span id="datamasterVersionText" class="text-gray-600">Feedmaster 0.8.9</span>
                    </div>
                </div>
                
                <!-- The actual live posts container (hidden) -->
                <div id="postsContainer" class="flex-grow overflow-y-auto border border-gray-200 rounded-md p-2" style="max-height: 500px; display: none;">
                    <p id="noPostsMessage" class="text-gray-500 text-center py-4" style="display: none;">Waiting for new posts...</p>
                </div>
                <div id="loadingIndicator" class="loading-indicator" style="display: none;"></div>

                <!-- Grid for rankings - Adjusted for 12 columns, and now flex-grow -->
                <div id="rankingsContent" class="grid grid-cols-1 md:grid-cols-12 gap-6 mt-6 w-full flex-grow">
                    <div class="md:col-span-3 flex flex-col" id="topHashtagsSection"> <!-- Top Hashtags (3/12) - now flex-col and takes vertical space -->
                        <h3 class="stylish-subheader">Top Hashtags</h3>
                        <div id="topTermsWrapper" class="ranking-scroll-area">
                            <div id="topTerms">
                                <p class="text-gray-500 text-center">No hashtags yet to analyze.</p>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-5 flex flex-col" id="topLinksSection"> <!-- Top Links (5/12) - now flex-col and takes vertical space -->
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="stylish-subheader mb-0">Top Links</h3>
                        </div>
                        <div id="topLinksWrapper" class="ranking-scroll-area">
                            <div id="topLinks">
                                <p class="text-gray-500 text-center">No rich link cards yet to display.</p>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-4 flex flex-col" id="rankedUsersSection"> <!-- Top Posters / Top Mentions (4/12) - now flex-col and takes vertical space -->
                        <div class="flex flex-col flex-grow"> <!-- Added flex-grow to make it take full height -->
                            <div class="flex items-center justify-between mb-4 flex-wrap"> <!-- Added flex-wrap for small screens -->
                                <h3 class="stylish-subheader flex-grow mb-0 mr-2">Ranked Users</h3> <!-- Generic title for the section -->
                                <div class="flex gap-2 flex-shrink-0">
                                    <button id="showPostersBtn" class="ranking-toggle-btn active">Posters</button>
                                    <button id="showMentionsBtn" class="ranking-toggle-btn">Mentions</button>
                                </div>
                            </div>
                            <!-- Content for Posters (initially visible) -->
                            <div id="postersContentWrapper" class="ranking-scroll-area"> <!-- flex-grow already here -->
                                <div id="topPostersList">
                                    <p class="text-gray-500 text-center">No posters yet to rank from the feed.</p>
                                </div>
                            </div>
                            <!-- Content for Mentions (initially hidden) -->
                            <div id="mentionsContentWrapper" class="ranking-scroll-area hidden"> <!-- flex-grow already here -->
                                <div id="topMentionsList">
                                    <p class="text-gray-500 text-center">No mentions yet to rank from the feed.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="md:col-span-4 flex flex-col" id="topSitesSection" style="display: none;"> <!-- Now flex-col and takes vertical space -->
                        <h3 class="stylish-subheader">Top Sites</h3>
                        <div id="topDomainsWrapper" class="ranking-scroll-area">
                            <div id="topDomains">
                                <p class="text-gray-500 text-center">No domains yet to analyze.</p>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-5 flex flex-col" id="contentTypeBreakdownSection" style="display: none;"> <!-- Now flex-col and takes vertical space -->
                        <h3 class="stylish-subheader">Content Type Breakdown</h3>
                        <div id="contentTypeBreakdownWrapper" class="ranking-scroll-area">
                            <div id="contentTypeBreakdown">
                                <p class="text-gray-500 text-center">No content types yet to analyze.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- NEW: Featured Feeds Content (hidden by default, shown for Datamaster feed) -->
                <div id="featuredFeedsContent" class="grid grid-cols-1 md:grid-cols-12 gap-6 mt-6 w-full" style="display: none;">
                    <h3 class="md:col-span-12 text-center text-gray-600 dark:text-gray-400">Discover other curated feeds!</h3>
                    <a href="#" class="featured-feed-card md:col-span-4" data-feed-id="urbanismPlus">
                        <img src="https://raw.githubusercontent.com/femavibes/datamaster/refs/heads/main/uplus.jpg" alt="Urbanism+ Logo" class="featured-feed-icon">
                        <div class="featured-feed-info">
                            <div class="featured-feed-name">Urbanism+</div>
                            <div class="featured-feed-description">Daily news and insights on urban planning, public transit, and walkable cities.</div>
                        </div>
                    </a>
                    <a href="#" class="featured-feed-card md:col-span-4" data-feed-id="bandcamp">
                        <img src="https://raw.githubusercontent.com/femavibes/datamaster/refs/heads/main/bandcamp7796.logowik.com.webp" alt="Bandcamp Logo" class="featured-feed-icon">
                        <div class="featured-feed-info">
                            <div class="featured-feed-name">Bandcamp</div>
                            <div class="featured-feed-description">Discover new music and independent artists trending on Bandcamp.</div>
                        </div>
                    </a>
                    <a href="#" class="featured-feed-card md:col-span-4" data-feed-id="transitSky">
                        <svg class="featured-feed-icon p-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm-1 14H7.5c-.276 0-.5-.224-.5-.5V7.5c0-.276.224-.5.5-.5H11V16zm5.5 0H13c-.276 0-.5-.224-.5-.5V7.5c0-.276.224-.5.5-.5H16.5c.276 0 .5.224.5.5V15.5c0 .276-.224.5-.5.5z"/>
                        </svg>
                        <div class="featured-feed-info">
                            <div class="featured-feed-name">TransitSky</div>
                            <div class="featured-feed-description">Stay updated on all things public transit across the globe.</div>
                        </div>
                    </a>
                </div>
                
                <!-- HIDDEN: Resolved DIDs List Section -->
                <div class="mt-8" style="display: none;">
                    <h3 class="stylish-subheader">Resolved User DIDs (Hidden)</h3>
                    <div id="resolvedDidsList" class="space-y-3">
                        <!-- Content for this div will still be generated by JS but not shown -->
                        <p class="text-gray-500 text-center">This section is hidden but DIDs are still resolved in the background.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Settings Modal Structure -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/3 lg:w-1/4">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Settings</h3>
            <div class="mb-4">
                <label class="inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                    <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    <span class="ms-3 text-sm font-medium text-gray-900 dark:text-gray-300">Dark Mode</span>
                </label>
            </div>
            <div class="mb-4">
                <label for="themeSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Theme:</label>
                <select id="themeSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="none">None</option>
                    <option value="pride">Pride Theme</option>
                    <option value="transgenderPride">Transgender Pride Theme</option>
                    <option value="blm">BLM Theme</option>
                    <!-- Add more themes here -->
                </select>
            </div>
            <button id="closeModalBtn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">Close</button>
        </div>
    </div>

    <!-- Link Posts Modal Structure -->
    <div id="linkPostsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 max-h-[90vh] flex flex-col">
            <h3 class="text-xl font-bold mb-4 text-gray-800" id="linkPostsModalTitle">Posts for Link</h3>
            <div id="linkPostsContent" class="flex-grow overflow-y-auto space-y-4">
                <!-- Posts will be dynamically loaded here -->
            </div>
            <button id="closeLinkPostsModalBtn" class="mt-6 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">Close</button>
        </div>
    </div>

    <!-- Plus Button Modal (New Feed Suggestion) -->
    <div id="plusButtonModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/2 lg:w-1/3 max-h-[90vh] flex flex-col text-center">
            <h3 class="text-xl font-bold mb-4 text-gray-800">Add a Feed to Fema's Datamaster</h3>
            <p class="text-gray-700 mb-4">Want to add a Feed to Fema's datamaster? This is something I am looking to support but for now feel free to reach out to me on Bluesky <a href="https://bsky.app/profile/fema.monster" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">@fema.monster</a>.</p>
            <p class="text-gray-700 mb-6">Consider donating to my Ko-Fi <a href="https://ko-fi.co/urbanismplus" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">https://ko.fi/urbanismplus</a> and mention "Datamaster" to earmark the funds for this project.</p>
            <button id="closePlusButtonModalBtn" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400">Close</button>
        </div>
    </div>

    <script type="module">
        // Firebase CDN imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs, serverTimestamp, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Removed fetchHeadline function as it's no longer needed, data will come from Contrails embeds.

        // Helper function to extract simplified base domain from a URL
        function getSimplifiedDomain(url) {
            let hostname;
            try {
                // Attempt to create a URL object. If it fails, prepend 'http://' and try again.
                // This handles cases where the link might just be a domain string (e.g., "example.com")
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    hostname = new URL(`http://${url}`).hostname.toLowerCase();
                } else {
                    hostname = new URL(url).hostname.toLowerCase();
                }
            } catch (e) {
                console.warn(`Could not parse URL "${url}", returning as is for domain extraction attempt:`, e);
                // Fallback: If URL parsing fails, try to extract something sensible from the raw string
                // This is a last resort to avoid 'Invalid Domain' for potentially malformed but recognizable strings
                const parts = url.toLowerCase().split('.');
                if (parts.length > 1) {
                    // Take the last part before the TLD (e.g., 'streetsblog' from 'streetsblog.org')
                    // This is a heuristic and might not be perfect for all TLDs (e.g., .co.uk)
                    const potentialDomain = parts[parts.length - 2] || parts[0];
                    return potentialDomain.replace(/^www\./, ''); // Ensure www is also removed from this fallback
                }
                return 'Invalid Domain'; // If all attempts fail
            }

            let domain = hostname.replace(/^www\./, ''); // Remove www. prefix from the hostname

            // List of common multi-part TLDs and then single-part TLDs.
            // Sorted by length descending to ensure longer TLDs (like .co.uk) are matched first.
            const knownTlds = [
                '.co.uk', '.com.au', '.org.uk', '.net.au', '.ac.uk', '.gov.uk',
                '.co.nz', '.org.nz', '.net.nz', '.ac.nz',
                '.co.jp', '.ne.jp', '.or.jp', '.ac.jp', '.ad.jp', '.ed.jp', '.go.jp', '.gr.jp', '.lg.jp',
                '.com.br', '.net.br', '.org.br',
                '.com.cn', '.net.cn', '.org.cn',
                '.com.hk', '.net.hk', '.org.hk',
                '.com',
